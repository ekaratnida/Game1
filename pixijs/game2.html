<!doctype html>
<html>
  <head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script src="https://pixijs.download/release/pixi.min.js"></script>
    <script src="Player.js"></script>
    <script src="Fruit.js"></script>
  </head>
  <body>
    <script>

      /*
      var settings = {
        "url": "https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT",
        "method": "GET",
        "timeout": 0,
      };
      var price;

      $.ajax(settings).done(function (response) {
        console.log(response);
        price = response;
      });
      */

      let app;
      let player;
      let fruit;
      let keys = {}

      window.onload = function() {
        // Create the application helper and add its render target to the page
        app = new PIXI.Application({ width: 800, height: 400, background: '#1099bb' });
        document.body.appendChild(app.view);
        
        //Load assets
        PIXI.Assets.add("fruit","images/sprites/Fruit.png")
        PIXI.Assets.add("player","images/sprites/player.png")
        PIXI.Assets.add("background","images/sprites/background.png");
        
        const texturePromise = PIXI.Assets.load(['player','background','fruit']);
        texturePromise.then(doneLoading);
        
        window.addEventListener("keydown", keysDown);
        window.addEventListener("keyup", keysUp);
      }

      function doneLoading(textures){
        createPlayer(textures);
        createFruit(textures,"bad");
        app.ticker.add(gameLoop);

      }

      function createPlayer(textures){
        player = new Player
        (
          app.view.width/2,
          app.view.height - 50,
          textures.player,
          "player",
          10,
          5,
          0.1,
          0.1
        );

        //console.log(player);
        app.stage.addChild(player)
      }

      function createFruit(textures,type){

        let rect;
        if (type=="good"){
          rect = new PIXI.Rectangle(0,0,32,32);
        }else{
          rect = new PIXI.Rectangle(0,32,32,32);
        }

        fruit = new Fruit
        (
          app.view.width/2,
          100,
          new PIXI.Texture(textures.fruit,rect),
          "fruit1",
          1,
          1,
          1
        );

        //console.log(player);
        app.stage.addChild(fruit)
      }

      function keysDown(e) {
          keys[e.keyCode] = true;
      }

      function keysUp(e) {
        keys[e.keyCode] = false;
      }

      function gameLoop(delta) {
        //console.info(JSON.stringify(keys));

        /*$.ajax(settings).done(function (response) {
            console.log(response);
            //price = response;
        });*/

        fruit.moveDown();

        if (keys["65"]){
          player.moveLeft()
         
        }

        if (keys["68"]){
          player.x += 5;
        }
      }

    </script>
  </body>
</html>